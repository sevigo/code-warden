=== RUN   TestValidateAndJoinPath_Security
=== RUN   TestValidateAndJoinPath_Security/valid_relative_path
=== RUN   TestValidateAndJoinPath_Security/simple_traversal_attempt
=== RUN   TestValidateAndJoinPath_Security/deep_traversal_attempt
=== RUN   TestValidateAndJoinPath_Security/current_directory_dot
--- PASS: TestValidateAndJoinPath_Security (0.00s)
    --- PASS: TestValidateAndJoinPath_Security/valid_relative_path (0.00s)
    --- PASS: TestValidateAndJoinPath_Security/simple_traversal_attempt (0.00s)
    --- PASS: TestValidateAndJoinPath_Security/deep_traversal_attempt (0.00s)
    --- PASS: TestValidateAndJoinPath_Security/current_directory_dot (0.00s)
=== RUN   TestValidateAndJoinPath_Symlinks
=== RUN   TestValidateAndJoinPath_Symlinks/symlink_traversal_(link_exists_points_out)
=== RUN   TestValidateAndJoinPath_Symlinks/lexical_traversal_with_non-existent_path
--- PASS: TestValidateAndJoinPath_Symlinks (0.00s)
    --- PASS: TestValidateAndJoinPath_Symlinks/symlink_traversal_(link_exists_points_out) (0.00s)
    --- PASS: TestValidateAndJoinPath_Symlinks/lexical_traversal_with_non-existent_path (0.00s)
=== RUN   TestGetDirectoryPath
--- PASS: TestGetDirectoryPath (0.00s)
=== RUN   TestCalculateDirectoryHash
--- PASS: TestCalculateDirectoryHash (0.00s)
=== RUN   TestExtractDocMetadata
--- PASS: TestExtractDocMetadata (0.00s)
=== RUN   TestStripMarkdownFence_Security
=== RUN   TestStripMarkdownFence_Security/trailing_content_after_fence
=== RUN   TestStripMarkdownFence_Security/multiple_fences_(should_take_first)
=== RUN   TestStripMarkdownFence_Security/no_closing_fence
=== RUN   TestStripMarkdownFence_Security/empty_input
--- PASS: TestStripMarkdownFence_Security (0.00s)
    --- PASS: TestStripMarkdownFence_Security/trailing_content_after_fence (0.00s)
    --- PASS: TestStripMarkdownFence_Security/multiple_fences_(should_take_first) (0.00s)
    --- PASS: TestStripMarkdownFence_Security/no_closing_fence (0.00s)
    --- PASS: TestStripMarkdownFence_Security/empty_input (0.00s)
=== RUN   TestParseSuggestionHeader_MaxLineLength_And_ReDoS
--- PASS: TestParseSuggestionHeader_MaxLineLength_And_ReDoS (0.00s)
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##__Suggestion__[internal/main.go:123]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[main.go:10-20]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_SUGGESTION_[C:\path\to\file.go:123]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[_src/foo.bar_:_456_]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[src/foo.bar:_456]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[invalid]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[:123]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[file.go:-5]
=== RUN   TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[file.go:0]
--- PASS: TestParseSuggestionHeader_FlexibleWhitespace (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##__Suggestion__[internal/main.go:123] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[main.go:10-20] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_SUGGESTION_[C:\path\to\file.go:123] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[_src/foo.bar_:_456_] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[src/foo.bar:_456] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[invalid] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[:123] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[file.go:-5] (0.00s)
    --- PASS: TestParseSuggestionHeader_FlexibleWhitespace/##_Suggestion_[file.go:0] (0.00s)
=== RUN   TestParseMarkdownReview
=== RUN   TestParseMarkdownReview/Valid_Review
=== RUN   TestParseMarkdownReview/Multiple_Suggestions
=== RUN   TestParseMarkdownReview/Empty_Input
=== RUN   TestParseMarkdownReview/Response_Wrapped_in_Markdown_Fence
=== RUN   TestParseMarkdownReview/No_Suggestions_Section
=== RUN   TestParseMarkdownReview/Suggestion_With_Whitespace_Before_Line_Number
=== RUN   TestParseMarkdownReview/Direct_Header_Format
=== RUN   TestParseMarkdownReview/Multiline_Suggestion
=== RUN   TestParseMarkdownReview/Verdict_does_not_leak_into_Summary
=== RUN   TestParseMarkdownReview/Suggestion_With_En_Dash_Range
=== RUN   TestParseMarkdownReview/Suggestion_Wrapped_in_Backticks
--- PASS: TestParseMarkdownReview (0.00s)
    --- PASS: TestParseMarkdownReview/Valid_Review (0.00s)
    --- PASS: TestParseMarkdownReview/Multiple_Suggestions (0.00s)
    --- PASS: TestParseMarkdownReview/Empty_Input (0.00s)
    --- PASS: TestParseMarkdownReview/Response_Wrapped_in_Markdown_Fence (0.00s)
    --- PASS: TestParseMarkdownReview/No_Suggestions_Section (0.00s)
    --- PASS: TestParseMarkdownReview/Suggestion_With_Whitespace_Before_Line_Number (0.00s)
    --- PASS: TestParseMarkdownReview/Direct_Header_Format (0.00s)
    --- PASS: TestParseMarkdownReview/Multiline_Suggestion (0.00s)
    --- PASS: TestParseMarkdownReview/Verdict_does_not_leak_into_Summary (0.00s)
    --- PASS: TestParseMarkdownReview/Suggestion_With_En_Dash_Range (0.00s)
    --- PASS: TestParseMarkdownReview/Suggestion_Wrapped_in_Backticks (0.00s)
=== RUN   TestStripMarkdownFence
=== RUN   TestStripMarkdownFence/No_fence
=== RUN   TestStripMarkdownFence/Markdown_fence
=== RUN   TestStripMarkdownFence/MD_fence
=== RUN   TestStripMarkdownFence/Not_a_markdown_fence
--- PASS: TestStripMarkdownFence (0.00s)
    --- PASS: TestStripMarkdownFence/No_fence (0.00s)
    --- PASS: TestStripMarkdownFence/Markdown_fence (0.00s)
    --- PASS: TestStripMarkdownFence/MD_fence (0.00s)
    --- PASS: TestStripMarkdownFence/Not_a_markdown_fence (0.00s)
=== RUN   TestPerformSingleHyDEJob_Reranking
=== RUN   TestPerformSingleHyDEJob_Reranking/Success:_Recall_20_->_Rerank_Top_5
=== RUN   TestPerformSingleHyDEJob_Reranking/Fallback:_Reranking_Fails_->_Return_Base_Recall_(Trimmed_to_5)
2026/02/12 02:44:59 WARN reranking failed, falling back error="rerank error"
=== RUN   TestPerformSingleHyDEJob_Reranking/Precision:_Recall_returns_fewer_than_TopK_->_Rerank_all
--- PASS: TestPerformSingleHyDEJob_Reranking (0.03s)
    --- PASS: TestPerformSingleHyDEJob_Reranking/Success:_Recall_20_->_Rerank_Top_5 (0.01s)
    --- PASS: TestPerformSingleHyDEJob_Reranking/Fallback:_Reranking_Fails_->_Return_Base_Recall_(Trimmed_to_5) (0.02s)
    --- PASS: TestPerformSingleHyDEJob_Reranking/Precision:_Recall_returns_fewer_than_TopK_->_Rerank_all (0.00s)
=== RUN   TestStripPatchNoise
=== RUN   TestStripPatchNoise/empty
=== RUN   TestStripPatchNoise/only_metadata
=== RUN   TestStripPatchNoise/mixed
    rag_rerank_test.go:122: stripPatchNoise() = "+func X() {}\n", want "+func X() {}"
=== RUN   TestStripPatchNoise/hyde_header_+_patch
    rag_rerank_test.go:122: stripPatchNoise() = "To understand... \n+func X() {}\n", want "To understand... \n+func X() {}"
--- FAIL: TestStripPatchNoise (0.00s)
    --- PASS: TestStripPatchNoise/empty (0.00s)
    --- PASS: TestStripPatchNoise/only_metadata (0.00s)
    --- FAIL: TestStripPatchNoise/mixed (0.00s)
    --- FAIL: TestStripPatchNoise/hyde_header_+_patch (0.00s)
=== RUN   TestPreFilterBM25
=== RUN   TestPreFilterBM25/topK_>=_len
=== RUN   TestPreFilterBM25/topK_<_len
=== RUN   TestPreFilterBM25/empty_query
    rag_rerank_test.go:145: preFilterBM25() len = 3, want 5
=== RUN   TestPreFilterBM25/empty_docs
--- FAIL: TestPreFilterBM25 (0.00s)
    --- PASS: TestPreFilterBM25/topK_>=_len (0.00s)
    --- PASS: TestPreFilterBM25/topK_<_len (0.00s)
    --- FAIL: TestPreFilterBM25/empty_query (0.00s)
    --- PASS: TestPreFilterBM25/empty_docs (0.00s)
=== RUN   TestSanitizeModelForFilename
=== RUN   TestSanitizeModelForFilename/kimi-k2.5:cloud
=== RUN   TestSanitizeModelForFilename/deepseek/v3
=== RUN   TestSanitizeModelForFilename/suspicious..name
=== RUN   TestSanitizeModelForFilename/<invalid>
=== RUN   TestSanitizeModelForFilename/COM1
=== RUN   TestSanitizeModelForFilename/CollisionResistance
--- PASS: TestSanitizeModelForFilename (0.00s)
    --- PASS: TestSanitizeModelForFilename/kimi-k2.5:cloud (0.00s)
    --- PASS: TestSanitizeModelForFilename/deepseek/v3 (0.00s)
    --- PASS: TestSanitizeModelForFilename/suspicious..name (0.00s)
    --- PASS: TestSanitizeModelForFilename/<invalid> (0.00s)
    --- PASS: TestSanitizeModelForFilename/COM1 (0.00s)
    --- PASS: TestSanitizeModelForFilename/CollisionResistance (0.00s)
=== RUN   TestProcessRelatedSnippet_Concurrency
--- PASS: TestProcessRelatedSnippet_Concurrency (0.00s)
FAIL
FAIL	github.com/sevigo/code-warden/internal/llm	0.128s
FAIL
